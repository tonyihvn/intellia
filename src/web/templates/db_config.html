{% extends "base.html" %}
{% block content %}
<title>Database Configuration</title>
<style>
    .config-form {
        max-width: 500px;
        margin: 20px auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    input[type="text"],
    input[type="password"],
    input[type="number"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }

    .btn-save {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-save:hover {
        background: #0056b3;
    }

    .error-message {
        color: #dc3545;
        margin-top: 10px;
        display: none;
    }

    .success-message {
        color: #28a745;
        margin-top: 10px;
        display: none;
    }
</style>
<div class="config-form card row">
    <h2>Database Configuration</h2>
    <form id="dbConfigForm">
        <div class="form-group">
            <label for="host">Host:</label>
            <input type="text" class="form-control" id="host" name="host" required>
        </div>
        <div class="form-group">
            <label for="port">Port:</label>
            <input type="number" class="form-control" id="port" name="port" required>
        </div>
        <div class="form-group">
            <label for="database">Database Name:</label>
            <input type="text" class="form-control" id="database" name="database" required>
        </div>
        <div class="form-group">
            <label for="user">Username:</label>
            <input type="text" class="form-control" id="user" name="user" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" name="password">
        </div>
        <button type="submit" class="btn btn-primary btn-save">Save Configuration</button>
    </form>
    <div id="errorMessage" class="error-message"></div>
    <div id="successMessage" class="success-message"></div>
</div>
{% endblock %}
{% block extra_js %}
<script>
    // Load current configuration
    fetch('/api/config/db')
        .then(response => response.json())
        .then(config => {
            const hostEl = document.getElementById('host');
            const portEl = document.getElementById('port');
            const dbEl = document.getElementById('database');
            const userEl = document.getElementById('user');
            const passEl = document.getElementById('password');
            if (hostEl) hostEl.value = config.host || '';
            if (portEl) portEl.value = config.port || '';
            if (dbEl) dbEl.value = config.database || '';
            if (userEl) userEl.value = config.user || '';
            if (passEl) passEl.value = config.password || '';
        });

    // Handle form submission
    const dbForm = document.getElementById('dbConfigForm');
    if (dbForm) {
        dbForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const hostEl = document.getElementById('host');
            const portEl = document.getElementById('port');
            const dbEl = document.getElementById('database');
            const userEl = document.getElementById('user');
            const passEl = document.getElementById('password');
            const errorEl = document.getElementById('errorMessage');
            const successEl = document.getElementById('successMessage');
            const config = {
                host: hostEl ? hostEl.value : '',
                port: portEl ? parseInt(portEl.value) : '',
                database: dbEl ? dbEl.value : '',
                user: userEl ? userEl.value : '',
                password: passEl ? passEl.value : ''
            };
            fetch('/api/config/db', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        if (errorEl) {
                            errorEl.textContent = data.error;
                            errorEl.style.display = 'block';
                        }
                        if (successEl) successEl.style.display = 'none';
                    } else {
                        if (successEl) {
                            successEl.textContent = 'Configuration saved successfully!';
                            successEl.style.display = 'block';
                        }
                        if (errorEl) errorEl.style.display = 'none';
                    }
                })
                .catch(error => {
                    if (errorEl) {
                        errorEl.textContent = error.message;
                        errorEl.style.display = 'block';
                    }
                    if (successEl) successEl.style.display = 'none';
                });
        });
    }
</script>
{% endblock %}